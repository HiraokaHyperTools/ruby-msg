<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mapi::Message
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mapi::Message";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mapi.html" title="Mapi (module)">Mapi</a></span></span>
     &raquo; 
    <span class="title">Message</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mapi::Message
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></li>
          
            <li class="next">Mapi::Message</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mapi/base.rb<span class="defines">,<br />
  lib/mapi/convert.rb,<br /> lib/mapi/convert/note-mime.rb,<br /> lib/mapi/convert/note-tmail.rb,<br /> lib/mapi/convert/contact.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>i refer to it as a message (as does mapi), although perhaps Item is better, as its a more general
concept than a message, as used in Pst files. though maybe i’ll switch to using
Mapi::Object as the base class there.</p>

<p>IMessage essentially, but there’s also stuff like IMAPIFolder etc. so, for this to form
basis for PST Item, it’d need to be more general.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Msg.html" title="Mapi::Msg (class)">Msg</a></span>, <span class='object_link'><a href="Pst/Item.html" title="Mapi::Pst::Item (class)">Pst::Item</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Message/Post.html" title="Mapi::Message::Post (class)">Post</a></span>, <span class='object_link'><a href="Message/VcardConverter.html" title="Mapi::Message::VcardConverter (class)">VcardConverter</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="CONVERSION_MAP-constant" class="">CONVERSION_MAP =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
	<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/x-vcard</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='symbol'>:to_vcard</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>vcf</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message/rfc822</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='symbol'>:to_mime</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>eml</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&#39;</span></span>     <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='symbol'>:to_post</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>txt</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
	<span class='comment'># ...
</span><span class='rbrace'>}</span></pre></dd>
      
    </dl>
  






  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Item.html#properties-instance_method" title="Mapi::Item#properties (method)">#properties</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#attachments-instance_method" title="#attachments (instance method)">#<strong>attachments</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>these 2 collections should be provided by our subclasses.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#body_to_mime-instance_method" title="#body_to_mime (instance method)">#<strong>body_to_mime</strong>  &#x21d2; Mime </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#body_to_tmail-instance_method" title="#body_to_tmail (instance method)">#<strong>body_to_tmail</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert-instance_method" title="#convert (instance method)">#<strong>convert</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Use to_s.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headers-instance_method" title="#headers (instance method)">#<strong>headers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mime-instance_method" title="#mime (instance method)">#<strong>mime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mime_type-instance_method" title="#mime_type (instance method)">#<strong>mime_type</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>get the mime type of the message.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#populate_headers-instance_method" title="#populate_headers (instance method)">#<strong>populate_headers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>copy data from msg properties storage to standard mime.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#recipients-instance_method" title="#recipients (instance method)">#<strong>recipients</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_mime-instance_method" title="#to_mime (instance method)">#<strong>to_mime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_post-instance_method" title="#to_post (instance method)">#<strong>to_post</strong>  &#x21d2; Post </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_tmail-instance_method" title="#to_tmail (instance method)">#<strong>to_tmail</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_vcard-instance_method" title="#to_vcard (instance method)">#<strong>to_vcard</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#type-instance_method" title="#type (instance method)">#<strong>type</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>redundant?.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Item.html#initialize-instance_method" title="Mapi::Item#initialize (method)">#initialize</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="Item.html#initialize-instance_method" title="Mapi::Item#initialize (method)">Mapi::Item</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="attachments-instance_method">
  
    #<strong>attachments</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>these 2 collections should be provided by our subclasses</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_attachments'>attachments</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="body_to_mime-instance_method">
  
    #<strong>body_to_mime</strong>  &#x21d2; <tt><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 149</span>

<span class='kw'>def</span> <span class='id identifier rubyid_body_to_mime'>body_to_mime</span>
	<span class='comment'># to create the body
</span>	<span class='comment'># should have some options about serializing rtf. and possibly options to check the rtf
</span>	<span class='comment'># for rtf2html conversion, stripping those html tags or other similar stuff. maybe want to
</span>	<span class='comment'># ignore it in the cases where it is generated from incoming html. but keep it if it was the
</span>	<span class='comment'># source for html and plaintext.
</span>	<span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_rtf'>body_rtf</span> <span class='kw'>or</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span>
		<span class='comment'># should plain come first?
</span>		<span class='id identifier rubyid_mime'>mime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: multipart/alternative\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
		<span class='comment'># its actually possible for plain body to be empty, but the others not.
</span>		<span class='comment'># if i can get an html version, then maybe a callout to lynx can be made...
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/plain\r\n\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
		<span class='comment'># this may be automatically unwrapped from the rtf if the rtf includes the html
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/html\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span>
		<span class='comment'># temporarily disabled the rtf. its just showing up as an attachment anyway.
</span>		<span class='comment'>#mime.parts &lt;&lt; Mime.new(&quot;Content-Type: text/rtf\r\n\r\n&quot;   + props.body_rtf)  if props.body_rtf
</span>		<span class='comment'># its thus currently possible to get no body at all if the only body is rtf. that is not
</span>		<span class='comment'># really acceptable FIXME
</span>		<span class='id identifier rubyid_mime'>mime</span>
	<span class='kw'>else</span>
		<span class='comment'># check no header case. content type? etc?. not sure if my Mime class will accept
</span>		<span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>taking that other path</span><span class='tstring_end'>&quot;</span></span>
		<span class='comment'># body can be nil, hence the to_s
</span>		<span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/plain\r\n\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="body_to_tmail-instance_method">
  
    #<strong>body_to_tmail</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-tmail.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_body_to_tmail'>body_to_tmail</span>
	<span class='comment'># to create the body
</span>	<span class='comment'># should have some options about serializing rtf. and possibly options to check the rtf
</span>	<span class='comment'># for rtf2html conversion, stripping those html tags or other similar stuff. maybe want to
</span>	<span class='comment'># ignore it in the cases where it is generated from incoming html. but keep it if it was the
</span>	<span class='comment'># source for html and plaintext.
</span>	<span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_rtf'>body_rtf</span> <span class='kw'>or</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span>
		<span class='comment'># should plain come first?
</span>		<span class='id identifier rubyid_part'>part</span> <span class='op'>=</span> <span class='const'>TMail</span><span class='op'>::</span><span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='comment'># its actually possible for plain body to be empty, but the others not.
</span>		<span class='comment'># if i can get an html version, then maybe a callout to lynx can be made...
</span>		<span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='const'>TMail</span><span class='op'>::</span><span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/plain\r\n\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
		<span class='comment'># this may be automatically unwrapped from the rtf if the rtf includes the html
</span>		<span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='const'>TMail</span><span class='op'>::</span><span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/html\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body_html'>body_html</span>
		<span class='comment'># temporarily disabled the rtf. its just showing up as an attachment anyway.
</span>		<span class='comment'>#mime.parts &lt;&lt; Mime.new(&quot;Content-Type: text/rtf\r\n\r\n&quot;   + props.body_rtf)  if props.body_rtf
</span>		<span class='comment'># its thus currently possible to get no body at all if the only body is rtf. that is not
</span>		<span class='comment'># really acceptable FIXME
</span>		<span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>multipart/alternative</span><span class='tstring_end'>&#39;</span></span>
		<span class='id identifier rubyid_part'>part</span>
	<span class='kw'>else</span>
		<span class='comment'># check no header case. content type? etc?. not sure if my Mime class will accept
</span>		<span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>taking that other path</span><span class='tstring_end'>&quot;</span></span>
		<span class='comment'># body can be nil, hence the to_s
</span>		<span class='const'>TMail</span><span class='op'>::</span><span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: text/plain\r\n\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert-instance_method">
  
    #<strong>convert</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns Use to_s.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Use to_s</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert.rb', line 38</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert'>convert</span>
	<span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_mime_type'>mime_type</span>
	<span class='kw'>unless</span> <span class='id identifier rubyid_pair'>pair</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#CONVERSION_MAP-constant" title="Mapi::Message::CONVERSION_MAP (constant)">CONVERSION_MAP</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unable to convert message with mime type - %p</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_type'>type</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_pair'>pair</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headers-instance_method">
  
    #<strong>headers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headers'>headers</span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
	<span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>message_class</span><span class='words_sep'> </span><span class='tstring_content'>from</span><span class='words_sep'> </span><span class='tstring_content'>to</span><span class='words_sep'> </span><span class='tstring_content'>subject</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
		<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
	<span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
	<span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> recipients=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_recipients'>recipients</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> attachments=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attachments'>attachments</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
	<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\w+$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mime-instance_method">
  
    #<strong>mime</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mime'>mime</span>
	<span class='kw'>return</span> <span class='ivar'>@mime</span> <span class='kw'>if</span> <span class='ivar'>@mime</span>
	<span class='comment'># if these headers exist at all, they can be helpful. we may however get a
</span>	<span class='comment'># application/ms-tnef mime root, which means there will be little other than
</span>	<span class='comment'># headers. we may get nothing.
</span>	<span class='comment'># and other times, when received from external, we get the full cigar, boundaries
</span>	<span class='comment'># etc and all.
</span>	<span class='comment'># sometimes its multipart, with no boundaries. that throws an error. so we&#39;ll be more
</span>	<span class='comment'># forgiving here
</span>	<span class='ivar'>@mime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_transport_message_headers'>transport_message_headers</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='kw'>true</span>
	<span class='id identifier rubyid_populate_headers'>populate_headers</span>
	<span class='ivar'>@mime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mime_type-instance_method">
  
    #<strong>mime_type</strong>  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>get the mime type of the message.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p><code>message/rfc822</code> and so on</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Not known converion way</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mime_type'>mime_type</span>
	<span class='kw'>case</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span> <span class='comment'>#.downcase &lt;- have a feeling i saw other cased versions
</span>	<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.Contact</span><span class='tstring_end'>&#39;</span></span>
		<span class='comment'># apparently &quot;text/directory; profile=vcard&quot; is what you&#39;re supposed to use
</span>		<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/x-vcard</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.Note</span><span class='tstring_end'>&#39;</span></span>
		<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message/rfc822</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.Post</span><span class='tstring_end'>&#39;</span></span>
		<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.StickyNote</span><span class='tstring_end'>&#39;</span></span>
		<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># hmmm....
</span>	<span class='kw'>else</span>
		<span class='const'><span class='object_link'><a href="../Mapi.html" title="Mapi (module)">Mapi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unknown message_class - %p</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span>
		<span class='kw'>nil</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="populate_headers-instance_method">
  
    #<strong>populate_headers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>copy data from msg properties storage to standard mime. headers
i’ve now seen it where the existing headers had heaps on stuff, and the msg#props had
practically nothing. think it was because it was a tnef - msg conversion done by exchange.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_populate_headers'>populate_headers</span>
	<span class='comment'># construct a From value
</span>	<span class='comment'># should this kind of thing only be done when headers don&#39;t exist already? maybe not. if its
</span>	<span class='comment'># sent, then modified and saved, the headers could be wrong?
</span>	<span class='comment'># hmmm. i just had an example where a mail is sent, from an internal user, but it has transport
</span>	<span class='comment'># headers, i think because one recipient was external. the only place the senders email address
</span>	<span class='comment'># exists is in the transport headers. so its maybe not good to overwrite from.
</span>	<span class='comment'># recipients however usually have smtp address available.
</span>	<span class='comment'># maybe we&#39;ll do it for all addresses that are smtp? (is that equivalent to 
</span>	<span class='comment'># sender_email_address !~ /^\//
</span>	<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_email'>email</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_sender_name'>sender_name</span><span class='comma'>,</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_sender_email_address'>sender_email_address</span>
	<span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_sender_addrtype'>sender_addrtype</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SMTP</span><span class='tstring_end'>&#39;</span></span>
		<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>From</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span> <span class='kw'>and</span> <span class='id identifier rubyid_email'>email</span> <span class='kw'>and</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>!=</span> <span class='id identifier rubyid_email'>email</span>
			<span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot; &lt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_email'>email</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>}</span></span><span class='rbracket'>]</span>
		<span class='kw'>else</span>
			<span class='lbracket'>[</span><span class='id identifier rubyid_email'>email</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rbracket'>]</span>
		<span class='kw'>end</span>
	<span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>From</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
		<span class='comment'># some messages were never sent, so that sender stuff isn&#39;t filled out. need to find another
</span>		<span class='comment'># way to get something
</span>		<span class='comment'># what about marking whether we thing the email was sent or not? or draft?
</span>		<span class='comment'># for partition into an eventual Inbox, Sent, Draft mbox set?
</span>		<span class='comment'># i&#39;ve now seen cases where this stuff is missing, but exists in transport message headers,
</span>		<span class='comment'># so maybe i should inhibit this in that case.
</span>		<span class='kw'>if</span> <span class='id identifier rubyid_email'>email</span>
			<span class='comment'># disabling this warning for now
</span>			<span class='comment'>#Log.warn &quot;* no smtp sender email address available (only X.400). creating fake one&quot;
</span>			<span class='comment'># this is crap. though i&#39;ve specially picked the logic so that it generates the correct
</span>			<span class='comment'># email addresses in my case (for my organisation).
</span>			<span class='comment'># this user stuff will give valid email i think, based on alias.
</span>			<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(.*), (.*)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\2.\\1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_email'>email</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\w+$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
			<span class='id identifier rubyid_domain'>domain</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_email'>email</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^/O=([^/]+)</span><span class='regexp_end'>}i</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.com</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>rescue</span> <span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span>
			<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>From</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot; &lt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='embexpr_end'>}</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_domain'>domain</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>}</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='embexpr_end'>}</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_domain'>domain</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
		<span class='kw'>elsif</span> <span class='id identifier rubyid_name'>name</span>
			<span class='comment'># we only have a name? thats screwed up.
</span>			<span class='comment'># disabling this warning for now
</span>			<span class='comment'>#Log.warn &quot;* no smtp sender email address available (only name). creating fake one&quot;
</span>			<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>From</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span><span class='rbracket'>]</span>
		<span class='kw'>else</span>
			<span class='comment'># disabling this warning for now
</span>			<span class='comment'>#Log.warn &quot;* no sender email address available at all. FIXME&quot;
</span>		<span class='kw'>end</span>
	<span class='comment'># else we leave the transport message header version
</span>	<span class='kw'>end</span>

	<span class='comment'># for all of this stuff, i&#39;m assigning in utf8 strings.
</span>	<span class='comment'># thats ok i suppose, maybe i can say its the job of the mime class to handle that.
</span>	<span class='comment'># but a lot of the headers are overloaded in different ways. plain string, many strings
</span>	<span class='comment'># other stuff. what happens to a person who has a &quot; in their name etc etc. encoded words
</span>	<span class='comment'># i suppose. but that then happens before assignment. and can&#39;t be automatically undone
</span>	<span class='comment'># until the header is decomposed into recipients.
</span>	<span class='id identifier rubyid_recips_by_type'>recips_by_type</span> <span class='op'>=</span> <span class='id identifier rubyid_recipients'>recipients</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='rbrace'>}</span>
	<span class='comment'># i want to the the types in a specific order.
</span>	<span class='lbracket'>[</span><span class='symbol'>:to</span><span class='comma'>,</span> <span class='symbol'>:cc</span><span class='comma'>,</span> <span class='symbol'>:bcc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
		<span class='comment'># for maximal (probably pointless) fidelity, we try to sort recipients by the
</span>		<span class='comment'># numerical part of the ole name
</span>		<span class='id identifier rubyid_recips'>recips</span> <span class='op'>=</span> <span class='id identifier rubyid_recips_by_type'>recips_by_type</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
		<span class='id identifier rubyid_recips'>recips</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_recips'>recips</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d{8}$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='rbrace'>}</span> <span class='kw'>rescue</span> <span class='id identifier rubyid_recips'>recips</span><span class='rparen'>)</span>
		<span class='comment'># switched to using , for separation, not ;. see issue #4
</span>		<span class='comment'># recips.empty? is strange. i wouldn&#39;t have thought it possible, but it was right?
</span>		<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(.)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span> <span class='rbrace'>}</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_recips'>recips</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_recips'>recips</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Subject</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='rparen'>)</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>

	<span class='comment'># fill in a date value. by default, we won&#39;t mess with existing value hear
</span>	<span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
		<span class='comment'># we want to get a received date, as i understand it.
</span>		<span class='comment'># use this preference order, or pull the most recent?
</span>		<span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>message_delivery_time</span><span class='words_sep'> </span><span class='tstring_content'>client_submit_time</span><span class='words_sep'> </span><span class='tstring_content'>last_modification_time</span><span class='words_sep'> </span><span class='tstring_content'>creation_time</span><span class='tstring_end'>]</span></span>
		<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='kw'>break</span> <span class='id identifier rubyid_time'>time</span> <span class='kw'>if</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
		<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='const'>Date</span> <span class='op'>===</span> <span class='id identifier rubyid_time'>time</span>

		<span class='comment'># now convert and store
</span>		<span class='comment'># this is a little funky. not sure about time zone stuff either?
</span>		<span class='comment'># actually seems ok. maybe its always UTC and interpreted anyway. or can be timezoneless.
</span>		<span class='comment'># i have no timezone info anyway.
</span>		<span class='comment'># in gmail, i see stuff like 15 Jan 2007 00:48:19 -0000, and it displays as 11:48.
</span>		<span class='comment'># can also add .localtime here if desired. but that feels wrong.
</span>		<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Date</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_iso8601'>iso8601</span><span class='lparen'>(</span><span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rfc2822'>rfc2822</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_time'>time</span>
	<span class='kw'>end</span>

	<span class='comment'># some very simplistic mapping between internet message headers and the
</span>	<span class='comment'># mapi properties
</span>	<span class='comment'># any of these could be causing duplicates due to case issues. the hack in #to_mime
</span>	<span class='comment'># just stops re-duplication at that point. need to move some smarts into the mime
</span>	<span class='comment'># code to handle it.
</span>	<span class='id identifier rubyid_mapi_header_map'>mapi_header_map</span> <span class='op'>=</span> <span class='lbracket'>[</span>
		<span class='lbracket'>[</span><span class='symbol'>:internet_message_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Message-ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='lbracket'>[</span><span class='symbol'>:in_reply_to_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>In-Reply-To</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='comment'># don&#39;t set these values if they&#39;re equal to the defaults anyway
</span>		<span class='lbracket'>[</span><span class='symbol'>:importance</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Importance</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='lbracket'>[</span><span class='symbol'>:priority</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Priority</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='lbracket'>[</span><span class='symbol'>:sensitivity</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sensitivity</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_val'>val</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='comment'># yeah?
</span>		<span class='lbracket'>[</span><span class='symbol'>:conversation_topic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Thread-Topic</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>?</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='comma'>,</span>
		<span class='comment'># not sure of the distinction here
</span>		<span class='comment'># :originator_delivery_report_requested ??
</span>		<span class='lbracket'>[</span><span class='symbol'>:read_receipt_requested</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Disposition-Notification-To</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_from'>from</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
	<span class='rbracket'>]</span>
	<span class='id identifier rubyid_mapi_header_map'>mapi_header_map</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mapi'>mapi</span><span class='comma'>,</span> <span class='id identifier rubyid_mime'>mime</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
		<span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_q'>q</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_mapi'>mapi</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_mime'>mime</span><span class='rparen'>)</span>
		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_f'>f</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='rparen'>)</span>
		<span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='id identifier rubyid_mime'>mime</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="recipients-instance_method">
  
    #<strong>recipients</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_recipients'>recipients</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_mime-instance_method">
  
    #<strong>to_mime</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_mime'>to_mime</span>
	<span class='comment'># intended to be used for IPM.note, which is the email type. can use it for others if desired,
</span>	<span class='comment'># YMMV
</span>	<span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_mime used on a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.Note</span><span class='tstring_end'>&#39;</span></span>
	<span class='comment'># we always have a body
</span>	<span class='id identifier rubyid_mime'>mime</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_body_to_mime'>body_to_mime</span>

	<span class='comment'># If we have attachments, we take the current mime root (body), and make it the first child
</span>	<span class='comment'># of a new tree that will contain body and attachments.
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_attachments'>attachments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_mime'>mime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: multipart/mixed\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_body'>body</span>
		<span class='comment'># i don&#39;t know any better way to do this. need multipart/related for inline images
</span>		<span class='comment'># referenced by cid: urls to work, but don&#39;t want to use it otherwise...
</span>		<span class='id identifier rubyid_related'>related</span> <span class='op'>=</span> <span class='kw'>false</span>
		<span class='id identifier rubyid_attachments'>attachments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attach'>attach</span><span class='op'>|</span>
			<span class='id identifier rubyid_part'>part</span> <span class='op'>=</span> <span class='id identifier rubyid_attach'>attach</span><span class='period'>.</span><span class='id identifier rubyid_to_mime'>to_mime</span>
			<span class='id identifier rubyid_related'>related</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-ID</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Location</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
			<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span>
		<span class='kw'>end</span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>multipart/related</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_related'>related</span>
	<span class='kw'>end</span>

	<span class='comment'># at this point, mime is either
</span>	<span class='comment'># - a single text/plain, consisting of the body (&#39;taking that other path&#39; above. rare)
</span>	<span class='comment'># - a multipart/alternative, consiting of a few bodies (plain and html body. common)
</span>	<span class='comment'># - a multipart/mixed, consisting of 1 of the above 2 types of bodies, and attachments.
</span>	<span class='comment'># we add this standard preamble if its multipart
</span>	<span class='comment'># FIXME preamble.replace, and body.replace both suck.
</span>	<span class='comment'># preamble= is doable. body= wasn&#39;t being done because body will get rewritten from parts
</span>	<span class='comment'># if multipart, and is only there readonly. can do that, or do a reparse...
</span>	<span class='comment'># The way i do this means that only the first preamble will say it, not preambles of nested
</span>	<span class='comment'># multipart chunks.
</span>	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_preamble'>preamble</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is a multi-part message in MIME format.\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_multipart?'>multipart?</span>

	<span class='comment'># now that we have a root, we can mix in all our headers
</span>	<span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_vals'>vals</span><span class='op'>|</span>
		<span class='comment'># don&#39;t overwrite the content-type, encoding style stuff
</span>		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_key'>key</span>
		<span class='comment'># some new temporary hacks
</span>		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>content-type</span><span class='regexp_end'>/i</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_vals'>vals</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>base64</span><span class='regexp_end'>/</span></span>
		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:downcase</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_vals'>vals</span>
	<span class='kw'>end</span>
	<span class='comment'># just a stupid hack to make the content-type header last
</span>	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span>

	<span class='id identifier rubyid_mime'>mime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_post-instance_method">
  
    #<strong>to_post</strong>  &#x21d2; <tt><span class='object_link'><a href="Message/Post.html" title="Mapi::Message::Post (class)">Post</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Message/Post.html" title="Mapi::Message::Post (class)">Post</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_post'>to_post</span>
	<span class='const'><span class='object_link'><a href="Message/Post.html" title="Mapi::Message::Post (class)">Post</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Message/Post.html#initialize-instance_method" title="Mapi::Message::Post#initialize (method)">new</a></span></span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_tmail-instance_method">
  
    #<strong>to_tmail</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-tmail.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_tmail'>to_tmail</span>
	<span class='comment'># intended to be used for IPM.note, which is the email type. can use it for others if desired,
</span>	<span class='comment'># YMMV
</span>	<span class='const'><span class='object_link'><a href="../Mapi.html#Log-constant" title="Mapi::Log (constant)">Log</a></span></span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_mime used on a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IPM.Note</span><span class='tstring_end'>&#39;</span></span>
	<span class='comment'># we always have a body
</span>	<span class='id identifier rubyid_mail'>mail</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_body_to_tmail'>body_to_tmail</span>

	<span class='comment'># If we have attachments, we take the current mime root (body), and make it the first child
</span>	<span class='comment'># of a new tree that will contain body and attachments.
</span>	<span class='kw'>unless</span> <span class='id identifier rubyid_attachments'>attachments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
		<span class='id identifier rubyid_mime'>mime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: multipart/mixed\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_body'>body</span>
		<span class='comment'># i don&#39;t know any better way to do this. need multipart/related for inline images
</span>		<span class='comment'># referenced by cid: urls to work, but don&#39;t want to use it otherwise...
</span>		<span class='id identifier rubyid_related'>related</span> <span class='op'>=</span> <span class='kw'>false</span>
		<span class='id identifier rubyid_attachments'>attachments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attach'>attach</span><span class='op'>|</span>
			<span class='id identifier rubyid_part'>part</span> <span class='op'>=</span> <span class='id identifier rubyid_attach'>attach</span><span class='period'>.</span><span class='id identifier rubyid_to_mime'>to_mime</span>
			<span class='id identifier rubyid_related'>related</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-ID</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Location</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
			<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_part'>part</span>
		<span class='kw'>end</span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>multipart/related</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_related'>related</span>
	<span class='kw'>end</span>

	<span class='comment'># at this point, mime is either
</span>	<span class='comment'># - a single text/plain, consisting of the body (&#39;taking that other path&#39; above. rare)
</span>	<span class='comment'># - a multipart/alternative, consiting of a few bodies (plain and html body. common)
</span>	<span class='comment'># - a multipart/mixed, consisting of 1 of the above 2 types of bodies, and attachments.
</span>	<span class='comment'># we add this standard preamble if its multipart
</span>	<span class='comment'># FIXME preamble.replace, and body.replace both suck.
</span>	<span class='comment'># preamble= is doable. body= wasn&#39;t being done because body will get rewritten from parts
</span>	<span class='comment'># if multipart, and is only there readonly. can do that, or do a reparse...
</span>	<span class='comment'># The way i do this means that only the first preamble will say it, not preambles of nested
</span>	<span class='comment'># multipart chunks.
</span>	<span class='id identifier rubyid_mail'>mail</span><span class='period'>.</span><span class='id identifier rubyid_quoted_body'>quoted_body</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This is a multi-part message in MIME format.\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_mail'>mail</span><span class='period'>.</span><span class='id identifier rubyid_multipart?'>multipart?</span>

	<span class='comment'># now that we have a root, we can mix in all our headers
</span>	<span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_vals'>vals</span><span class='op'>|</span>
		<span class='comment'># don&#39;t overwrite the content-type, encoding style stuff
</span>		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
		<span class='comment'># some new temporary hacks
</span>		<span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>content-type</span><span class='regexp_end'>/i</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_vals'>vals</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>base64</span><span class='regexp_end'>/</span></span>
		<span class='comment'>#next if mime.headers.keys.map(&amp;:downcase).include? key.downcase
</span>		<span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_vals'>vals</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
	<span class='kw'>end</span>
	<span class='comment'># just a stupid hack to make the content-type header last
</span>	<span class='comment'>#mime.headers[&#39;Content-Type&#39;] = mime.headers.delete &#39;Content-Type&#39;
</span>
	<span class='id identifier rubyid_mail'>mail</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_vcard-instance_method">
  
    #<strong>to_vcard</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/contact.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_vcard'>to_vcard</span>
	<span class='comment'>#p props.raw.reject { |key, value| key.guid.inspect !~ /00062004-0000-0000-c000-000000000046/ }.
</span>	<span class='comment'>#	map { |key, value| [key.to_sym, value] }.reject { |a, b| b.respond_to? :read }
</span>	<span class='comment'>#y props.to_h.reject { |a, b| b.respond_to? :read }
</span>	<span class='const'><span class='object_link'><a href="Message/VcardConverter.html" title="Mapi::Message::VcardConverter (class)">VcardConverter</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Message/VcardConverter.html#initialize-instance_method" title="Mapi::Message::VcardConverter#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_convert'><span class='object_link'><a href="Message/VcardConverter.html#convert-instance_method" title="Mapi::Message::VcardConverter#convert (method)">convert</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="type-instance_method">
  
    #<strong>type</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>redundant?</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_type'>type</span>
	<span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_message_class'>message_class</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>IPM\.(.*)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Dec 25 18:24:03 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.6.5).
</div>

    </div>
  </body>
</html>