<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mapi::Attachment
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mapi::Attachment";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mapi.html" title="Mapi (module)">Mapi</a></span></span>
     &raquo; 
    <span class="title">Attachment</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mapi::Attachment
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></li>
          
            <li class="next">Mapi::Attachment</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mapi/base.rb<span class="defines">,<br />
  lib/mapi/convert/note-mime.rb,<br /> lib/mapi/convert/note-tmail.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>a general attachment class. is subclassed by Msg and Pst attachment classes</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Msg/Attachment.html" title="Mapi::Msg::Attachment (class)">Msg::Attachment</a></span>, <span class='object_link'><a href="Pst/Attachment.html" title="Mapi::Pst::Attachment (class)">Pst::Attachment</a></span></p>
</div>






  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Item.html#properties-instance_method" title="Mapi::Item#properties (method)">#properties</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data-instance_method" title="#data (instance method)">#<strong>data</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filename-instance_method" title="#filename (instance method)">#<strong>filename</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>(io)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>with new stream work, its possible to not have the whole thing in memory at one time, just to save an attachment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_mime-instance_method" title="#to_mime (instance method)">#<strong>to_mime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_tmail-instance_method" title="#to_tmail (instance method)">#<strong>to_tmail</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Item.html" title="Mapi::Item (class)">Item</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Item.html#initialize-instance_method" title="Mapi::Item#initialize (method)">#initialize</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="Item.html#initialize-instance_method" title="Mapi::Item#initialize (method)">Mapi::Item</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="data-instance_method">
  
    #<strong>data</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data'>data</span>
	<span class='ivar'>@embedded_msg</span> <span class='op'>||</span> <span class='ivar'>@embedded_ole</span> <span class='op'>||</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_data'>attach_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="filename-instance_method">
  
    #<strong>filename</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_filename'>filename</span>
	<span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_long_filename'>attach_long_filename</span> <span class='op'>||</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_filename'>attach_filename</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 37</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
	<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\w+$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
		<span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> filename=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span>
		<span class='lparen'>(</span><span class='ivar'>@embedded_ole</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> embedded_type=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@embedded_ole</span><span class='period'>.</span><span class='id identifier rubyid_embedded_type'>embedded_type</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save-instance_method">
  
    #<strong>save</strong>(io)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>with new stream work, its possible to not have the whole thing in memory at one time,
just to save an attachment</p>

<p>a = msg.attachments.first
a.save open(File.basename(a.filename || ‘attachment’), ‘wb’)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/base.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span> <span class='id identifier rubyid_io'>io</span>
	<span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can only save binary data blobs, not ole dirs</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@embedded_ole</span>
	<span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
	<span class='id identifier rubyid_io'>io</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>8192</span><span class='rparen'>)</span> <span class='kw'>until</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_eof?'>eof?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_mime-instance_method">
  
    #<strong>to_mime</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-mime.rb', line 228</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_mime'>to_mime</span>
	<span class='comment'># TODO: smarter mime typing.
</span>	<span class='id identifier rubyid_mimetype'>mimetype</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_mime_tag'>attach_mime_tag</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/octet-stream</span><span class='tstring_end'>&#39;</span></span>
	<span class='id identifier rubyid_mime'>mime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Mime.html#initialize-instance_method" title="Mapi::Mime#initialize (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mimetype'>mimetype</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span>
		<span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>attachment; filename=&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span>
	<span class='rbracket'>]</span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Transfer-Encoding</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>base64</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_location'>attach_content_location</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_location'>attach_content_location</span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_id'>attach_content_id</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_id'>attach_content_id</span>
	<span class='comment'># data.to_s for now. data was nil for some reason.
</span>	<span class='comment'># perhaps it was a data object not correctly handled?
</span>	<span class='comment'># hmmm, have to use read here. that assumes that the data isa stream.
</span>	<span class='comment'># but if the attachment data is a string, then it won&#39;t work. possible?
</span>	<span class='id identifier rubyid_data_str'>data_str</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@embedded_msg</span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message/rfc822</span><span class='tstring_end'>&#39;</span></span>
		<span class='comment'># lets try making it not base64 for now
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Transfer-Encoding</span><span class='tstring_end'>&#39;</span></span>
		<span class='comment'># not filename. rather name, or something else right?
</span>		<span class='comment'># maybe it should be inline?? i forget attach_method / access meaning
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span>
			<span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>attachment; filename=&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Mime.html" title="Mapi::Mime (class)">Mime</a></span></span><span class='op'>::</span><span class='id identifier rubyid_to_encoded_word'>to_encoded_word</span><span class='lparen'>(</span><span class='ivar'>@embedded_msg</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span>
		<span class='rbracket'>]</span>
		<span class='ivar'>@embedded_msg</span><span class='period'>.</span><span class='id identifier rubyid_to_mime'>to_mime</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='kw'>elsif</span> <span class='ivar'>@embedded_ole</span>
		<span class='comment'># kind of hacky
</span>		<span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../StringIO.html" title="StringIO (class)">StringIO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='const'>Ole</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ole'>ole</span><span class='op'>|</span>
			<span class='id identifier rubyid_ole'>ole</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='symbol'>:dir</span>
			<span class='const'>Ole</span><span class='op'>::</span><span class='const'>Storage</span><span class='op'>::</span><span class='const'>Dirent</span><span class='period'>.</span><span class='id identifier rubyid_copy'>copy</span> <span class='ivar'>@embedded_ole</span><span class='comma'>,</span> <span class='id identifier rubyid_ole'>ole</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span>
		<span class='kw'>end</span>
		<span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
	<span class='kw'>else</span>
		<span class='comment'># FIXME: shouldn&#39;t be required
</span>		<span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>rescue</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span> <span class='ivar'>@embedded_msg</span> <span class='op'>?</span> <span class='id identifier rubyid_data_str'>data_str</span> <span class='op'>:</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_encode64'>encode64</span><span class='lparen'>(</span><span class='id identifier rubyid_data_str'>data_str</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='id identifier rubyid_mime'>mime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_tmail-instance_method">
  
    #<strong>to_tmail</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mapi/convert/note-tmail.rb', line 237</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_tmail'>to_tmail</span>
	<span class='comment'># TODO: smarter mime typing.
</span>	<span class='id identifier rubyid_mimetype'>mimetype</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_mime_tag'>attach_mime_tag</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/octet-stream</span><span class='tstring_end'>&#39;</span></span>
	<span class='id identifier rubyid_part'>part</span> <span class='op'>=</span> <span class='const'>TMail</span><span class='op'>::</span><span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mimetype'>mimetype</span><span class='embexpr_end'>}</span><span class='tstring_content'>\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
	<span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>attachment; filename=&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span>
	<span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Transfer-Encoding</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>base64</span><span class='tstring_end'>&#39;</span></span>
	<span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_location'>attach_content_location</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_location'>attach_content_location</span>
	<span class='id identifier rubyid_part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_id'>attach_content_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_props'>props</span><span class='period'>.</span><span class='id identifier rubyid_attach_content_id'>attach_content_id</span>
	<span class='comment'># data.to_s for now. data was nil for some reason.
</span>	<span class='comment'># perhaps it was a data object not correctly handled?
</span>	<span class='comment'># hmmm, have to use read here. that assumes that the data isa stream.
</span>	<span class='comment'># but if the attachment data is a string, then it won&#39;t work. possible?
</span>	<span class='id identifier rubyid_data_str'>data_str</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='ivar'>@embedded_msg</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message/rfc822</span><span class='tstring_end'>&#39;</span></span>
		<span class='comment'># lets try making it not base64 for now
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Transfer-Encoding</span><span class='tstring_end'>&#39;</span></span>
		<span class='comment'># not filename. rather name, or something else right?
</span>		<span class='comment'># maybe it should be inline?? i forget attach_method / access meaning
</span>		<span class='id identifier rubyid_mime'>mime</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Disposition</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>attachment; filename=&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@embedded_msg</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>}</span></span><span class='rbracket'>]</span>
		<span class='ivar'>@embedded_msg</span><span class='period'>.</span><span class='id identifier rubyid_to_mime'>to_mime</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='kw'>elsif</span> <span class='ivar'>@embedded_ole</span>
		<span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
		<span class='comment'># kind of hacky
</span>		<span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../StringIO.html" title="StringIO (class)">StringIO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
		<span class='const'>Ole</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_io'>io</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ole'>ole</span><span class='op'>|</span>
			<span class='id identifier rubyid_ole'>ole</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='symbol'>:dir</span>
			<span class='const'>Ole</span><span class='op'>::</span><span class='const'>Storage</span><span class='op'>::</span><span class='const'>Dirent</span><span class='period'>.</span><span class='id identifier rubyid_copy'>copy</span> <span class='ivar'>@embedded_ole</span><span class='comma'>,</span> <span class='id identifier rubyid_ole'>ole</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span>
		<span class='kw'>end</span>
		<span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
	<span class='kw'>else</span>
		<span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
	<span class='kw'>end</span>
	<span class='id identifier rubyid_part'>part</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='ivar'>@embedded_msg</span> <span class='op'>?</span> <span class='id identifier rubyid_data_str'>data_str</span> <span class='op'>:</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_encode64'>encode64</span><span class='lparen'>(</span><span class='id identifier rubyid_data_str'>data_str</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
	<span class='id identifier rubyid_part'>part</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Dec 25 18:24:03 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.6.5).
</div>

    </div>
  </body>
</html>